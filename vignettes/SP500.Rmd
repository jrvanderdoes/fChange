---
title: "SP500"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SP500}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

This vignette is focused on an application in finance, specifically the S\&P500 index. \code{fChange} includes this data as \code{SPYUS500}, which is pre-loaded. The aim is to detect changes in the stock prices.

# Change Point Detection

The data is collected at minutely resolution. We convert it into the overnight cumulative intraday returns below, and plot it.
```{r functions}
library(fChange)

compute_ocidr <- function(dat){
  dat_cidr <- dat
  dat_cidr[,1]  <- 100*(log(dat[,1]) - log(dat[1,1]))
  # Obs
  for(j in 2:ncol(dat_cidr)){ 
    dat_cidr[,j] <- 100 * 
      ( log(dat[,j]) - log(dat[nrow(dat_cidr),j-1]) )
  }
  
  dat_cidr
}

SPYUS_ocidr <- compute_ocidr(SPYUS500)

plot_ocidr <- plot(funts(SPYUS_ocidr),
                      val_axis_title = '',res_axis_title = '',FD_axis_title = '',
                      plot_title = '')
```

The changes can be detected using binary segmentation as follows.
```{r detect_changes, eval=FALSE}

set.seed(25641)
spy_min_cps <- binary_segmentation(SPYUS_ocidr,
                                   statistic='Tn',
                                   method='Sim',
                                   h_function = function(X){ncol(X)^(1/3)})
plot_ocidr <- plot(funts(SPYUS_ocidr),CPs = spy_min_cps[[1]],
                      val_axis_title = '',res_axis_title = '',FD_axis_title = '',
                      plot_title = '')
```


