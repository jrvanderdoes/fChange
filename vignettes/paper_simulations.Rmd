---
title: "paper_simulations"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{paper_simulations}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(fChange)
```

```{r}
# Normal
nTrials <- 1000
Len <- 100 # 100, 250, 500
dat_res <- 21
spaces <- c('BM','OU','PC','RN')

results <- data.frame('length'=rep(NA,nTrials*length(spaces)),
                      'space'=NA,
                      'h0'=NA, 'h13'=NA, 'hd13'=NA,
                      'h23'=NA, 'hd23'=NA)
set.seed(12345)
for(i in 1:nTrials){
  cat(paste0(i,', '))
  X <- generate_data_fd(
    ns = Len,
    eigsList = list(5:1),
    basesList = list(
      fda::create.bspline.basis(nbasis = 5, norder = 4)
    ),
    meansList = c(0),
    distsArray = c("Normal"),
    evals = seq(0, 1, length.out=dat_res),
    kappasArray = c(0),
    silent = T
  )
  
  for(s in 1:length(spaces)){
    tmp0 <- detect_changepoint_final_Tn(X, h=0,space=spaces[s])
    tmp13 <- detect_changepoint_final_Tn(X, h=Len^(1/3),space=spaces[s])
    tmpd13 <- detect_changepoint_final_Tn(X, h=2*Len^(1/3),space=spaces[s])
    tmp23 <- detect_changepoint_final_Tn(X, h=Len^(2/3),space=spaces[s])
    tmpd23 <- detect_changepoint_final_Tn(X, h=2*Len^(2/3),space=spaces[s])
    
    results[length(spaces)*(i-1)+s,] <- 
      c(Len, spaces[s], 
        tmp0$pval, tmp13$pval, tmpd13$pval, tmp23$pval, tmpd23$pval)
  }
}

```
