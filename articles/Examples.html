<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Examples â€¢ fChange</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Examples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fChange</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Examples.html">Examples</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Examples</h1>
            
      

      <div class="d-none name"><code>Examples.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jrvanderdoes.github.io/fChange/">fChange</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'fChange'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     acf, pacf, qqplot, sd, var</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this article, we examine severl applications for fChange.</p>
</div>
<div class="section level2">
<h2 id="electricity">Electricity<a class="anchor" aria-label="anchor" href="#electricity"></a>
</h2>
<p>This section examines the hourly Spanish electricity spot price from
2014. This data is loaded into <span class="math inline">${\tt
fChange}$</span>, and can be retrieved by calling
<code>electricity</code>. The goal is to detect any changes in the
data.</p>
<p>This data may be viewed using the following:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">electricity</span>,</span>
<span>        val_axis_title <span class="op">=</span> <span class="st">''</span>,res_axis_title <span class="op">=</span> <span class="st">''</span>,FD_axis_title <span class="op">=</span> <span class="st">''</span>,</span>
<span>        plot_title <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span></code></pre></div>
<p>This data seems to exhibit some trends over time (perhaps due to
season). We wish to model these trends first, and then search the data
for any remaining changes. We will use principal component analysis to
convert it to finite dimensions, fit a model, and return this to
functional data. In , and are pre-built functions that can be used to
project the data, e.g.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pca_examination.html">pca_examination</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">electricity</span>,TVE <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">654321</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu">change</span><span class="op">(</span>X <span class="op">=</span> <span class="va">epca</span><span class="op">$</span><span class="va">residuals</span>,</span>
<span>                           statistic<span class="op">=</span><span class="st">'Tn'</span>,</span>
<span>                           critical <span class="op">=</span> <span class="st">'simulation'</span>,method <span class="op">=</span> <span class="st">'characteristic'</span>,</span>
<span>               type <span class="op">=</span> <span class="st">'segmentation'</span><span class="op">)</span></span></code></pre></div>
<p>The previous approach is similar to the next, except without
smoothing incorporated. In the next, we show the details more precisely.
We use binary segmentation to investigate the residuals in this
case.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123456</span><span class="op">)</span></span>
<span><span class="va">elec_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/projection_model.html">projection_model</a></span><span class="op">(</span><span class="va">electricity</span>,TVE<span class="op">=</span><span class="fl">0.95</span>,model<span class="op">=</span><span class="st">'ets'</span>, check.cp<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">elec_mod</span><span class="op">$</span><span class="va">errors</span>,changes <span class="op">=</span> <span class="va">elec_mod</span><span class="op">$</span><span class="va">changes</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sp-500">S&amp;P 500<a class="anchor" aria-label="anchor" href="#sp-500"></a>
</h2>
<p>This section is focused on an application in finance, specifically
the S&amp;P500 index. includes this data as , which is pre-loaded. The
aim is to detect changes in the stock prices.</p>
<p>The data is collected at minutely resolution. We convert it into the
overnight cumulative intraday returns below, and plot it.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compute_ocidr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">dat_cidr</span> <span class="op">&lt;-</span> <span class="va">dat</span></span>
<span>  <span class="va">dat_cidr</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Obs</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">dat_cidr</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> </span>
<span>    <span class="va">dat_cidr</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> </span>
<span>      <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_cidr</span><span class="op">)</span>,<span class="va">j</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">dat_cidr</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">SPYUS_ocidr</span> <span class="op">&lt;-</span> <span class="fu">compute_ocidr</span><span class="op">(</span><span class="va">SPYUS500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_ocidr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/dfts.html">dfts</a></span><span class="op">(</span><span class="va">SPYUS_ocidr</span><span class="op">)</span>,</span>
<span>                      val_axis_title <span class="op">=</span> <span class="st">''</span>,res_axis_title <span class="op">=</span> <span class="st">''</span>,FD_axis_title <span class="op">=</span> <span class="st">''</span>,</span>
<span>                      plot_title <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span></code></pre></div>
<p>The changes can be detected using binary segmentation as follows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">25641</span><span class="op">)</span></span>
<span><span class="va">spy_min_changes</span> <span class="op">&lt;-</span> <span class="fu">change</span><span class="op">(</span><span class="fu"><a href="../reference/dfts.html">dfts</a></span><span class="op">(</span><span class="va">SPYUS_ocidr</span><span class="op">)</span>, type<span class="op">=</span><span class="st">'segmentation'</span>,</span>
<span>                                   statistic<span class="op">=</span><span class="st">'Tn'</span>,</span>
<span>                                   critical<span class="op">=</span><span class="st">'simulation'</span>,</span>
<span>                                   method <span class="op">=</span> <span class="st">'characteristic'</span><span class="op">)</span></span>
<span><span class="va">plot_ocidr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/dfts.html">dfts</a></span><span class="op">(</span><span class="va">SPYUS_ocidr</span><span class="op">)</span>,changes <span class="op">=</span> <span class="va">spy_min_changes</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                      val_axis_title <span class="op">=</span> <span class="st">''</span>,res_axis_title <span class="op">=</span> <span class="st">''</span>,FD_axis_title <span class="op">=</span> <span class="st">''</span>,</span>
<span>                      plot_title <span class="op">=</span> <span class="st">''</span>,type <span class="op">=</span> <span class="st">'highdim'</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jeremy VanderDoes, Gregory Rice, Martin Wendler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
